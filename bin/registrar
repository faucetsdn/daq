#!/bin/bash -e

ROOT=$(realpath $(dirname $0)/..)
cd $ROOT

source misc/config_base.sh

if [ -z "$gcp_cred" ]; then
    echo Need to define [gcp_cred] config variable.
    false
fi

if [ -z "$site_path" ]; then
    echo Need to define [site_path] config variable.
    false
fi

if [ -z "$schema_path" ]; then
    echo Need to define [schema_path] config variable.
    false
fi

validator/bin/build

export GOOGLE_CLOUD_PROJECT=foobar
export GOOGLE_APPLICATION_CREDENTIALS=$PWD/$gcp_cred
echo Using credentials from $GOOGLE_APPLICATION_CREDENTIALS

env

validator/bin/registrar $gcp_cred $site_path $schema_path $*
